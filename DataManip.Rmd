---
title: "DataManip"
author: "Jenna Korobova"
date: "6/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(HLMdiag)
library(wesanderson)
library(gridExtra)
```

# Data Manipulation and EDA

```{r}
housing <- read_csv("housingAll.csv")

housing2 <- housing %>%
  filter(type == "apartment", price <= 5000) %>%
  select(-c(region, electric_vehicle_charge))

n <- nrow(housing2)

set.seed(790)
index <- sample(n, 2000, replace = FALSE)
housing_subset <- housing2[index,]

write.csv(housing_subset, "housingSubset.csv")
```

```{r}
 table(housing_subset$type)
 ggplot(housing_subset) + geom_histogram(aes(x = price))
 housing_subset <- housing_subset %>% filter(price < 5000)

 table(housing_subset$cats_allowed)
 table(housing_subset$dogs_allowed)
 table(housing_subset$smoking_allowed)
 table(housing_subset$wheelchair_access)
 table(housing_subset$comes_furnished)
```

## EDA Jaylin
```{r}
data <- read_csv("housingSubset.csv")
ggplot(data) + geom_boxplot(aes(y = price, x = cats_allowed, group = cats_allowed))
ggplot(data) + geom_boxplot(aes(y = price, x = dogs_allowed, group = dogs_allowed))
ggplot(data) + geom_boxplot(aes(y = price, x = smoking_allowed, group = smoking_allowed))
ggplot(data) + geom_boxplot(aes(y = price, x = wheelchair_access, group = wheelchair_access))
ggplot(data) + geom_boxplot(aes(y = price, x = comes_furnished, group = comes_furnished))
#none of these seem that important 

ggplot(data, aes(x = beds, y = price)) + geom_point() + geom_jitter()
```
Should we take out all of the 0s? 

```{r}
ggplot(data) + geom_histogram(aes(x = price), color = "white", bins = 25)

data %>%
  filter(price != 0) %>%
  ggplot() + geom_histogram(aes(x = log(price)), color = "white", bins = 25)
```

```{r}
ggplot(data) + geom_point(aes(x = PopDensity, y = price))
largePop <- data[which(data$PopDensity > 7500),]

data[which(data$PopDensity > 7500),c(15, 18:20)] #population density in DC is ridiculous 

data %>%
  filter(state != "dc") %>%
  ggplot() + geom_point(aes(x = PopDensity, y = price)) #slight positive correlation 
```

```{r}
data %>%
  group_by(`State Name`) %>%
  summarize(MedianPrice = median(price)) %>%
  ggplot() + geom_bar(aes(x = reorder(`State Name`, MedianPrice), y = MedianPrice), stat = "identity") + coord_flip()
``` 
Top 5 states: DC, Hawaii, New Jersey, New Hampshire, California
Bottom 5 states: Kansas, Missouri, Oklahoma, West Virginia, Mississippi 

## EDA Jenna

```{r Boxplots of Price by Level One Vars}
#scale_fill_manual(values = wes_palette("Moonrise2", n = 2)) 

housing_subset$cats_allowed2 <- factor(housing_subset$cats_allowed, levels = c(0,1))
housing_subset$dogs_allowed2 <- factor(housing_subset$dogs_allowed, levels = c(0,1))
housing_subset$smoking_allowed2 <- factor(housing_subset$smoking_allowed, levels = c(0,1))
housing_subset$wheelchair_access2 <- factor(housing_subset$wheelchair_access, levels = c(0,1))
housing_subset$comes_furnished2 <- factor(housing_subset$comes_furnished, levels = c(0,1))

p1 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = cats_allowed2)) + 
  labs(x = "Cats Allowed") 
  

p2 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = dogs_allowed2)) + 
  labs(x = "Dogs Allowed") 

p3 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = smoking_allowed2)) + 
  labs(x = "Smoking Allowed") 

p4 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = wheelchair_access2)) + 
  labs(x = "Wheelchair Access") 

p5 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = comes_furnished2)) + 
  labs(x = "Comes Furnished")  

grid.arrange(p1, p2, p3, p4, p5, ncol = 2)
```

```{r Boxplots of Price by Level Two Vars}
#scale_fill_manual(values = wes_palette("Moonrise2", n = 2)) 

housing_subset2 <- na.omit(housing_subset) # DC has no governor
housing_subset$DeathPenalty2 <- factor(housing_subset$DeathPenalty, levels = c(0,1))

p1.2 <- ggplot(housing_subset2) + 
  geom_boxplot(mapping = aes(y = price, x = Governor)) + 
  labs(x = "Governor Political Party") 

p2.2 <- ggplot(housing_subset) + 
  geom_boxplot(mapping = aes(y = price, x = DeathPenalty2)) + 
  labs(x = "Death Penalty in State") 

grid.arrange(p1.2, p2.2, ncol = 1)
```

```{r Levels One and Two}
#scale_fill_manual(values = wes_palette("Moonrise2", n = 2)) 

housing_subset3 <- subset(housing_subset, subset = sqfeet < 3500)

# linetype isn't an ideal aesthetic here but it helps a little

ggplot(housing_subset3, mapping = aes(y = price, x = sqfeet, group = as.factor(beds))) + 
  geom_point(aes(color = as.factor(beds))) +
  geom_smooth(aes(linetype = as.factor(beds)), method = "lm", se = FALSE, color = "black")
  labs(title = "Scatterplot of Sqft by Price") 
  
# not very important it seems  
ggplot(housing_subset, mapping = aes(y = price, x = PctBlack)) +
  geom_point()
 
# DC has incredibly high popdensity, might lead to some outliers, let's try subsetting it out
ggplot(housing_subset, mapping = aes(y = price, x = PopDensity)) +
  geom_point()

# as popdensity increases, price increases, likely because those are cities
housing_subset4 <- subset(housing_subset, subset = state != "dc") %>%
  group_by(state)
ggplot(housing_subset4, mapping = aes(y = price, x = PopDensity)) +
  geom_point() + 
  geom_smooth(se = FALSE, method = "lm")

# I have no idea what's happening here
ggplot(housing_subset, mapping = aes(y = price, x = TaxRate)) +
  geom_point() + 
  geom_smooth(se = FALSE, method = "lm")
```

```{r Hist of Price}
# skewed right still, might need to log tranform anyway
ggplot(housing_subset, mapping = aes(x = price)) +
  geom_histogram()
```

